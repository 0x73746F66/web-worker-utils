<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <link href="https://preview.c9.io/chrisdlangton/web-workers/styles/main.css" rel="stylesheet">
</head>
<body>
  <h1 id="greeting">Web Worker Test</h1>
  
  <pre id="log">
      
  </pre>
  
  <script type="text/javascript">
    if (typeof SharedWorker != 'undefined') {
        var worker = new Worker('https://preview.c9.io/chrisdlangton/web-workers/js/worker.js');
        
        worker.onerror = function(e) {
            document.getElementById('log').insertAdjacentHTML('beforeEnd','error encountered'+"\n"); 
            console.error('Ops, something bad occurred!', e);
        };

        worker.postMessage({
          do: 'start'
        });
        
        worker.onmessage = function(e) {
            document.getElementById('log').insertAdjacentHTML('beforeEnd', JSON.stringify(e.data)+"\n" ); 
            console.debug(e.data);
        };
        
        setTimeout(function(){

            worker.postMessage({
                do: 'info'
            });

        }, 3000);
        
        setTimeout(function(){

            worker.postMessage({
                do: 'echo',
                message: 'testing'
            });

        }, 1000);
    }
    
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('https://preview.c9.io/chrisdlangton/web-workers/js/service.js').then(function(registration) {
        // Registration was successful
        console.log('ServiceWorker registration successful with scope: ',    registration.scope);
      }).catch(function(err) {
        // registration failed :(
        console.log('ServiceWorker registration failed: ', err);
      });
    }
  </script>
</body>
</html>